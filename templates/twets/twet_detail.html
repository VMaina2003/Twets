{% extends "twets/base.html" %}
{% block title %}Twet Detail{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-gray-200">
  
  <!-- Twet Content -->
  <div class="mb-4">
    <h2 class="font-semibold text-lg text-gray-900">{{ twet.user.username }}</h2>
    <p class="text-gray-700 mt-2">{{ twet.content }}</p>

    {% if twet.image %}
      <div class="mt-3 rounded-lg overflow-hidden border border-gray-200">
        <img src="{{ twet.image.url }}" alt="Twet image" class="w-full h-auto object-cover">
      </div>
    {% endif %}
  </div>

  <!-- Like + Comment Count -->
  <div class="flex items-center space-x-6 text-sm text-gray-500 mb-6">
    <form action="{% url 'like_twet' twet.id %}" method="POST">
      {% csrf_token %}
      <button type="submit" class="hover:underline">
        Like ({{ twet.total_likes }})
      </button>
    </form>
    <span>Comments ({{ twet.total_comments }})</span>
  </div>

  <!-- Comments Section -->
  <div>
    <h3 class="font-medium text-gray-800 mb-3">Comments</h3>
    
    <!-- Add Comment Form -->
    <form method="POST" class="mb-4">
      {% csrf_token %}
      <textarea name="content" rows="2" class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-300" placeholder="Write a comment..."></textarea>
      <button type="submit" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Post Comment</button>
    </form>

    <!-- List of Comments -->
    <div class="space-y-3">
     {% for comment in comments %}
  <div class="p-3 bg-gray-50 rounded-lg border flex justify-between items-start">
    <div>
      <p class="text-sm text-gray-900">
        <strong>{{ comment.user.username }}</strong> {{ comment.content }}
      </p>
      <span class="text-xs text-gray-500">{{ comment.created_at|date:"M d, Y H:i" }}</span>
    </div>

    {% if comment.user == request.user %}
      <form method="POST" action="{% url 'delete_comment' comment.id %}">
        {% csrf_token %}
        <button type="submit" class="text-red-500 text-xs hover:underline ml-4">Delete</button>
      </form>
    {% endif %}
  </div>
{% endfor %}

    </div>
  </div>
</div>
{% endblock %}
